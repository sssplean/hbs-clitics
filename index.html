<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Enklitika Trener</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <div class="sentence-container" id="sentence"></div>
  <div class="enclitic-options" id="encliticOptions"></div>
  <div>
    <button onclick="loadExample()">🔁 Novi primjer</button>
    <button onclick="checkAnswer()">✅ Gotovo</button>
  </div>
  <div id="feedback"></div>

  <script src="enclitics-data.js"></script>
  <script>
    let currentExample = {};
    let insertedSlots = {};

    function loadExample() {
      insertedSlots = {};
      document.getElementById('feedback').textContent = '';
      const sentence = document.getElementById('sentence');
      const encliticOptions = document.getElementById('encliticOptions');
      sentence.innerHTML = '';
      encliticOptions.innerHTML = '';

      currentExample = encliticsExamples[Math.floor(Math.random() * encliticsExamples.length)];

      currentExample.parts.forEach((word, i) => {
        const wb = document.createElement('div');
        wb.className = 'word-block';
        wb.textContent = word;
        sentence.appendChild(wb);

        const drop = document.createElement('div');
        drop.className = 'drop-slot';
        drop.dataset.index = i+1;
        drop.addEventListener('dragover', ev => {
          ev.preventDefault();
          drop.classList.add('over');
        });
        drop.addEventListener('dragleave', () => drop.classList.remove('over'));
        drop.addEventListener('drop', ev => {
          ev.preventDefault();
          drop.classList.remove('over');
          const encl = ev.dataTransfer.getData('text/plain');
          if (!(currentExample.enclitics.includes(encl) || currentExample.distractors.includes(encl))) return;
          // remove from previous slot
          for (const idx in insertedSlots) {
            if (insertedSlots[idx] === encl) delete insertedSlots[idx];
            document.querySelector(`.drop-slot[data-index="${idx}"]`).innerHTML = '';
          }
          // place in new
          const div = document.createElement('div');
          div.className = 'inserted-enclitic';
          div.textContent = encl;
          div.draggable = true;
          div.addEventListener('dragstart', ev => {
            ev.dataTransfer.setData('text/plain', encl);
          });
          drop.innerHTML = '';
          drop.appendChild(div);
          insertedSlots[drop.dataset.index] = encl;
        });
        sentence.appendChild(drop);
      });
      // after last word, extra slot:
      const dropLast = document.createElement('div');
      dropLast.className = 'drop-slot';
      dropLast.dataset.index = currentExample.parts.length+1;
      dropLast.addEventListener('dragover', ev => {ev.preventDefault(); dropLast.classList.add('over');});
      dropLast.addEventListener('dragleave', () => dropLast.classList.remove('over'));
      dropLast.addEventListener('drop', ev => {
        ev.preventDefault();
        dropLast.classList.remove('over');
        const encl = ev.dataTransfer.getData('text/plain');
        if (!(currentExample.enclitics.includes(encl) || currentExample.distractors.includes(encl))) return;
        for (const idx in insertedSlots) {
          if (insertedSlots[idx] === encl) delete insertedSlots[idx];
          document.querySelector(`.drop-slot[data-index="${idx}"]`).innerHTML = '';
        }
        const div = document.createElement('div');
        div.className = 'inserted-enclitic';
        div.textContent = encl;
        div.draggable = true;
        div.addEventListener('dragstart', ev => {
          ev.dataTransfer.setData('text/plain', encl);
        });
        dropLast.innerHTML = '';
        dropLast.appendChild(div);
        insertedSlots[dropLast.dataset.index] = encl;
      });
      sentence.appendChild(dropLast);

      const opts = [...currentExample.enclitics, ...currentExample.distractors].sort(() => Math.random()-0.5);
      opts.forEach(encl => {
        const opt = document.createElement('div');
        opt.className = 'enclitic-option';
        opt.textContent = encl;
        opt.draggable = true;
        opt.addEventListener('dragstart', ev => {
          ev.dataTransfer.setData('text/plain', encl);
        });
        encliticOptions.appendChild(opt);
      });
    }

    function checkAnswer() {
      const feedback = document.getElementById('feedback');
      const placed = Object.entries(insertedSlots)
        .filter(([,e]) => currentExample.enclitics.includes(e))
        .map(([i,e]) => Number(i));
      let correct = true;
      currentExample.enclitics.forEach((e, idx) => {
        const expect = currentExample.correctIndexes[idx];
        if (!placed.includes(expect)) correct = false;
      });
      if (Object.keys(insertedSlots).length < currentExample.enclitics.length) {
        feedback.textContent = '❗ Ubaci sve enklitike.';
        feedback.style.color = 'orange';
        return;
      }
      feedback.textContent = correct ? '✅ Tačno!' : '❌ Nije tačno.';
      feedback.style.color = correct ? 'green' : 'red';
    }

    window.loadExample = loadExample;
    window.checkAnswer = checkAnswer;
    document.addEventListener('DOMContentLoaded', loadExample);
  </script>
</body>
</html>
