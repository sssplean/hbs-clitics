<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Enclitics Trainer</title>
  <style>
    body {
      font-family: sans-serif;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: start;
      height: 100vh;
      margin: 0;
      background-color: #f5f6fa;
      padding: 2rem;
    }

    .sentence-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      justify-content: center;
      align-items: center;
      margin-bottom: 2rem;
    }

    .word-block {
      background-color: #dfe6e9;
      border-radius: 10px;
      padding: 0.5rem 1rem;
      min-width: 50px;
      text-align: center;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.1);
    }

    .inserted-enclitic {
      background-color: #a29bfe;
      color: white;
      cursor: pointer;
    }

    .drop-slot {
      width: 1rem;
      height: 2.5rem;
      margin: 0 0.2rem;
      transition: all 0.2s ease;
    }

    .drop-slot.over {
      width: 2.5rem;
      border: 2px dashed #74b9ff;
      background-color: #dfefff;
      border-radius: 5px;
    }

    .enclitic-option {
      background-color: #fab1a0;
      border-radius: 8px;
      padding: 0.5rem 1rem;
      margin: 0.3rem;
      cursor: grab;
      box-shadow: 1px 1px 3px rgba(0,0,0,0.1);
      user-select: none;
    }

    .enclitic-options {
      display: flex;
      justify-content: center;
      flex-wrap: wrap;
      margin-bottom: 1rem;
    }

    button {
      padding: 0.5rem 1.5rem;
      background-color: #74b9ff;
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1rem;
      box-shadow: 1px 1px 4px rgba(0,0,0,0.2);
      margin: 0.5rem;
    }

    #feedback {
      font-weight: bold;
      margin-top: 1rem;
    }
  </style>
</head>
<body>
  <div class="sentence-container" id="sentence"></div>
  <div class="enclitic-options" id="encliticOptions"></div>
  <div>
    <button onclick="loadExample()">üîÅ Novi primjer</button>
    <button onclick="checkAnswer()">‚úÖ Gotovo</button>
  </div>
  <div id="feedback"></div>

  <script src="enclitics-data.js"></script>
  <script>
    window.onload = function () {
      let currentExample = {};
      let inserted = [];

      function loadExample() {
        const sentence = document.getElementById('sentence');
        const encliticOptions = document.getElementById('encliticOptions');
        const feedback = document.getElementById('feedback');
        sentence.innerHTML = '';
        encliticOptions.innerHTML = '';
        feedback.textContent = '';
        inserted = [];

        currentExample = encliticsExamples[Math.floor(Math.random() * encliticsExamples.length)];

        for (let i = 0; i <= currentExample.parts.length; i++) {
          const drop = document.createElement('div');
          drop.className = 'drop-slot';
          drop.dataset.index = i;
          drop.addEventListener('dragover', e => {
            e.preventDefault();
            drop.classList.add('over');
          });
          drop.addEventListener('dragleave', () => {
            drop.classList.remove('over');
          });
          drop.addEventListener('drop', e => {
            e.preventDefault();
            drop.classList.remove('over');
            const enclitic = e.dataTransfer.getData('text/plain');
            if (inserted.includes(enclitic)) return;
            inserted.push(enclitic);

            const word = document.createElement('div');
            word.className = 'word-block inserted-enclitic';
            word.textContent = enclitic;
            word.addEventListener('click', () => {
              word.remove();
              inserted = inserted.filter(item => item !== enclitic);
              const opt = document.createElement('div');
              opt.className = 'enclitic-option';
              opt.textContent = enclitic;
              opt.draggable = true;
              opt.addEventListener('dragstart', e => {
                e.dataTransfer.setData('text/plain', enclitic);
              });
              encliticOptions.appendChild(opt);
            });

            drop.insertAdjacentElement('afterend', word);
          });
          sentence.appendChild(drop);

          if (i < currentExample.parts.length) {
            const wordEl = document.createElement('div');
            wordEl.className = 'word-block';
            wordEl.textContent = currentExample.parts[i];
            sentence.appendChild(wordEl);
          }
        }

        const allOptions = [...currentExample.enclitics, ...currentExample.distractors].sort(() => Math.random() - 0.5);
        allOptions.forEach(text => {
          const opt = document.createElement('div');
          opt.className = 'enclitic-option';
          opt.textContent = text;
          opt.draggable = true;
          opt.addEventListener('dragstart', e => {
            e.dataTransfer.setData('text/plain', text);
          });
          encliticOptions.appendChild(opt);
        });
      }

      function checkAnswer() {
        const allWords = Array.from(document.querySelectorAll('.sentence-container .word-block')).map(e => e.textContent);
        const actualEnclitics = allWords.filter(word => currentExample.enclitics.includes(word));

        let correct = true;
        let pointer = 0;

        for (let i = 0; i < allWords.length; i++) {
          if (currentExample.enclitics.includes(allWords[i])) {
            if (i !== currentExample.correctIndexes[pointer] + pointer) {
              correct = false;
              break;
            }
            pointer++;
          }
        }

        const feedback = document.getElementById('feedback');
        if (actualEnclitics.length !== currentExample.enclitics.length) {
          feedback.textContent = '‚ùó Mora≈° ubaciti sve enklitike.';
          feedback.style.color = 'orange';
        } else if (correct && pointer === currentExample.enclitics.length) {
          feedback.textContent = '‚úÖ Taƒçno!';
          feedback.style.color = 'green';
        } else {
          feedback.textContent = '‚ùå Nije taƒçno. Poku≈°aj ponovo.';
          feedback.style.color = 'red';
        }
      }

      window.loadExample = loadExample;
      window.checkAnswer = checkAnswer;

      loadExample();
    };
  </script>
</body>
</html>
